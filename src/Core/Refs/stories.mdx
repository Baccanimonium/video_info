import { Meta } from '@storybook/addon-docs/blocks'

# Блок работы со справочниками
<Meta title="Core/Справочники(Refs)" />

## Service

#### Назначение

* Загрузка и кэширование справочников, кэширование важно для загрузчиков списков при отображении их в UI

#### Методы

| Название | Описание |
|---|---|
| `getRef` | Дефолтная функция загрузки справочников |
| `loadRefList` | Функция загрузки группы справочников используется в компонентах которые получают список **ID** и загружают по ним списки|

#### Модуль BoundPagePermissionsToApiService

Этот модуль предназначен для того, чтобы передавать параметры прав страницы в текущий запрос

## WithRefLoaderHoc

#### Назначение

* Загружает справочники
* Отслеживает парамеры необходимые для загрузки справочника
* Осуществляет блокировку компонента если недостаточно параметров для работы компонента

#### Методы

| Название | Описание |
|---|---|
| `useState:options` | Состояние загружаемых опций |
| `useState:prevRefParams` | состояние предыдущих параметров для загрузки данных, по ним идет сравнение нужно ли перезагружать данные |
| `useState:loading` | Флаг загрузки данных |
| `unwrapParam` | Функция распаковки параметров из контекста поля |
| `findPreviousValue` | Функция поиска опций по значению поля |
| `dynamicParams` | Memoized функция расчета параметров из контекста поля  |
| `isAllDynamicParamsProvided` | Memoized функция расчета флага есть ли у поля все параметры необходимые для загрузки опций |
| `loadRef` | Функция загрузки опций |
| `useWatch:dynamicParams` | Хук отслеживающий параметры необходимые для загрузки данных справочника |
| `useEffect` | Хук определяющий нужно ли загружать данные при первом отрисовки |


#### Пропсы

| Название | Описание |
|---|---|
| `multiple` | Флаг указывающий на тип данных с которым работает поле, массив или нет |
| `preload` | Флаг указывающий на то, будет ли загрузка при первом выводе в UI |
| `returnOption` | Флаг указывающий будет ли выбираться в опцию объект или нет |
| `value` | значение поля |
| `reference` | Имя справочника с которым осуществляется работа |
| `disabled` | Флаг указывающий заблокировано ли поле или нет  |
| `paramsMap` | Map параметров которые необходимо передать из контекста поля в запрос |
| `formPayload` | Контекст данных поля |
| `alwaysReload` | Флаг переопределяющий поведение поля, позволяющий ему загружать данные без контекста |
| `allWaysOpen` | Флаг переопределяющий поведение по умолчанию, загрузка будет выполнена при первичном выводе в UI |
| `refParams` | статичный объект передаваемый в каждый запрос |
| `labelKey` | ключ выводимый в UI  |
| `valueKey` | ключ по которому сравнивается значение опций и **value** поля |
| `ID_ENTITY_OBJ` | **ID** права страницы |
| `refLoader` | функция загрузки справочника |
| `getValue` | функция получения значения из контекста поля |

## DecoratorRefValueResolver

#### Назначение
* Преобразует список **ID** в список нормальных имен справочников
* Загружает справочники

#### Пропсы

| Название | Описание |
|---|---|
| `value` | Значение поля |
| `multiple` |  Флаг указывающий на тип данных с которым работает поле, массив или нет  |
| `reference` | Имя справочника с которым осуществляется работа |
| `refParams` | статичный объект передаваемый в каждый запрос |
| `options` | статичные опции поля из которых будет считаться значения выводимые в UI |
| `valueKey` | ключ по которому сравнивается значение опций и **value** поля  |

#### Методы

| Название | Описание |
|---|---|
| `getOptions` | функция поиска опций по значению |
| `getRefList` | Функция определяющая каким способом будут получаться опции соответствующие значению поля |
| `useState:resolvedValue` | состояние преобразованного значения в опции |
| `useEffect:эфект перезагрузки опций` | Эффект пересчета значения на опции  |

## filterRefByDependency

#### Назначение
* функция фильтрующая значения по набору опций

#### Аргументы

* dependencyKey = Ключ
* multiple является ли значение массивом
* dependencyNewVal опции по которым фильтруются значение
* columnVal фильтруемые значения
