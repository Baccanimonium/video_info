import { Meta } from '@storybook/addon-docs/blocks'

# Контроллер страницы работающий с состоянием вкладки
<Meta title="Core/Контроллер страницы(PageController)" />

#### Подключение

```
import CratePageController, { withCreateSnapshotAfterLoadNewData } from "@/Core/PageController"

class Page {
    ...
}

export default CratePageController(Page, { service, childrenRoutes, plugins: [withCreateSnapshotAfterLoadNewData] })
```
[Полный гайд по созданию страницы](?path=/story/guides-добавление-новой-страницы--page)

#### Назначение

* Загрузка данных как изначальная, так и по смене флагов **fetched** и **loading** или в результате работы плагина
* Предоставление функционала блокировки закрытия вкладки, смены маршрута и тд
* Отрисовка детей по правам и распределение данных **tabState** между ними
* Связь маршрута и данных страницы между собой

#### Пропсы компонента доступные ему от контроллера

* data - основные данные страницы, которые загружаются с помощью метода **lodaData**
* loading - флаг указывающий, что в текущий момент осуществляется запрос на сервер. служит маркером для блокировки кнопок
* fetched - флаг указывающий, что данные(**data**) успешно получены
* uploadDataOnce - флаг указывающий, что данные(**data**) были загружены хотя бы ран
* updateTabState - функция позволяющая обновить состояние страницы
* pageRights - права страницы

#### Особенности

* Если в функцию создания контроллера не передать service, будет создан функциональный компонент
* Контролер создан для работы с родительским компонентом **Tab** или другими **PageController**-ами

#### Методы

| Название | Описание |
|---|---|
| `setOverRideSaveDataFunction` | Сохраняет в состояние страницы функцию посредника перед сохранением страницы |
| `setDataChangedFlag` | Функция блокировщик смены маршрута страницы, содержит внутри перехватчик открывающий модальное окно для пользователя с предупреждением о не сохраненных данных. вызывается непосредственно разработчиком в коде, например передана в форму как **onChange** обработчик|
| `unsetDataChangedFlag` | Функция снятия блокировщика смены маршрута(вызов **unBlockHistory**) и флага изменения **data** страницы |
| `unBlockHistory` | Функция снятия блокировщика смены маршрута |
| `blockWindowReload` | Функция перехватчик смены маршрута, добавляется как обработчик функцией **setDataChangedFlag**, она же внутри имеет функционал отмены |
| `loadData` | Функция загрузки **data**, ***новая data на страницу должны попадать исключительно через нее*** |
| `saveData` | Функция сохранения **data**, ***новая data должна быть сохранена исключительно через нее*** |
| `requestWrapper` | Вспомогательная функция нужна для загрузки и сохранения **data** и установки необходимых флагов  |
| `isDataNeedToUpload` | Функция отслеживающая необходимость перезагрузки **data** страницы |
| `storeData` | Функция улучшение жизни, позволяет обновить **data** страницы |
| `saveEntireDocument` | Функция позволяющая сохранить всех **детей** и саму **data** страницы |
| `updateChildrenState` | Функция обновления внутреннего состояния детей |
| `memoizedPath` | Функция хранящая в себе путь 404 для детей |
| `resolveChildrenRoutes` | Первый слой работы с **детьми**, прописывает им корректные маршруты |
| `filteredByRightsChildrenRoutes` | Второй слой работы с **детьми**, проверяет их доступность по правам |
| `renderChildrenRoutes` | Функция отрисовки детей, учитывающая маршрут и права страницы |

#### Модуль BoundPagePermissionsToApiService

Этот модуль предназначен для того, чтобы передавать параметры прав страницы в текущий запрос
